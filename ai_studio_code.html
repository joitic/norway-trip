<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>挪威冬日旅程 2026</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- SortableJS & Vuedraggable -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Vue.Draggable/4.1.0/vuedraggable.umd.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;700&family=Noto+Sans+TC:wght@300;400;700&display=swap');
        
        body {
            font-family: 'Noto Sans JP', 'Noto Sans TC', sans-serif;
            background-color: #f0f4f8; /* 挪威冰雪底色延伸 */
            -webkit-tap-highlight-color: transparent;
        }

        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* 日系極簡陰影 */
        .jp-shadow {
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
        }

        /* 底部導航安全區 (iOS) */
        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }

        /* 行程卡片動畫 */
        .list-enter-active, .list-leave-active { transition: all 0.4s ease; }
        .list-enter-from, .list-leave-to { opacity: 0; transform: translateY(20px); }
    </style>
</head>
<body>
    <div id="app" v-cloak>
        <!-- 頁首 Banner -->
        <header class="relative h-[250px] w-full overflow-hidden">
            <img src="https://images.unsplash.com/photo-1520106212299-d99c443e4568?auto=format&fit=crop&w=1920&q=80" 
                 class="w-full h-full object-cover" alt="Norway Canyon">
            
            <!-- 浮動 Tab 按鈕 -->
            <div class="absolute bottom-12 right-4 flex gap-2">
                <button v-for="tab in tabs" :key="tab.id" 
                    @click="currentTab = tab.id"
                    :class="['p-3 rounded-full transition-all duration-300 jp-shadow', 
                             currentTab === tab.id ? 'bg-[#0c4a6e] text-white' : 'bg-white/80 text-[#0c4a6e] backdrop-blur']">
                    <i :data-lucide="tab.icon" class="w-5 h-5"></i>
                </button>
            </div>
        </header>

        <!-- 主內容區域 (負邊距向上拉) -->
        <main class="relative -mt-8 px-4 pb-32">
            <div class="bg-[#f0f4f8] rounded-t-[32px] pt-6 min-h-screen">
                
                <!-- 1. 每日行程表 -->
                <section v-if="currentTab === 'itinerary'">
                    <!-- 橫向日期選單 -->
                    <div class="flex overflow-x-auto hide-scrollbar gap-3 mb-6 px-2">
                        <div v-for="(day, index) in travelDays" :key="index"
                             @click="selectedDayIndex = index"
                             :class="['flex-shrink-0 w-14 py-3 rounded-2xl flex flex-col items-center transition-all',
                                      selectedDayIndex === index ? 'bg-[#0c4a6e] text-white shadow-lg scale-105' : 'bg-white text-zinc-400']">
                            <span class="text-[10px] font-bold uppercase">{{ day.week }}</span>
                            <span class="text-xl font-bold">{{ day.date }}</span>
                        </div>
                    </div>

                    <!-- 天氣資訊 -->
                    <div class="bg-white/60 backdrop-blur rounded-2xl p-4 mb-4 flex items-center justify-between jp-shadow border border-white/40">
                        <div class="flex items-center gap-3">
                            <i data-lucide="cloud-snow" class="w-8 h-8 text-[#7dd3fc]"></i>
                            <div>
                                <div class="text-sm font-bold text-zinc-500">今日天氣 · 特羅姆瑟</div>
                                <div class="text-lg font-black text-zinc-800">-4°C <span class="text-xs font-normal">體感 -8°C</span></div>
                            </div>
                        </div>
                        <span class="text-[10px] bg-blue-100 text-blue-600 px-2 py-1 rounded-full font-bold">下雪中</span>
                    </div>

                    <!-- 行程列表 (Draggable) -->
                    <draggable v-model="currentDayItems" item-key="id" handle=".handle">
                        <template #item="{element, index}">
                            <div>
                                <!-- 交通時間分隔 -->
                                <div v-if="index > 0" class="flex items-center gap-2 my-2 ml-10">
                                    <div class="border-l-2 border-dashed border-zinc-300 h-6"></div>
                                    <div class="flex items-center gap-1 text-[10px] text-zinc-400 font-bold">
                                        <i data-lucide="car" class="w-3 h-3"></i>
                                        <span>{{ element.travelTime || '15 min' }}</span>
                                    </div>
                                </div>

                                <!-- 行程卡片 -->
                                <div :class="['relative bg-white rounded-3xl p-4 mb-3 jp-shadow border-l-8 transition-all', 
                                            getCategoryColor(element.category)]">
                                    <div class="flex justify-between items-start">
                                        <div class="flex gap-3 items-center handle">
                                            <div class="bg-zinc-100 p-2 rounded-xl">
                                                <i :data-lucide="getCategoryIcon(element.category)" class="w-5 h-5 text-zinc-600"></i>
                                            </div>
                                            <div>
                                                <div class="text-[10px] font-bold text-zinc-400">{{ element.category }}</div>
                                                <h3 class="text-lg font-black text-[#0c4a6e]">{{ element.name }}</h3>
                                            </div>
                                        </div>
                                        <button @click="openNavigation(element.name)" class="p-2 bg-blue-50 rounded-full">
                                            <i data-lucide="navigation" class="w-5 h-5 text-blue-600"></i>
                                        </button>
                                    </div>

                                    <div class="mt-3 grid grid-cols-2 gap-2 text-xs text-zinc-500">
                                        <div v-if="element.time" class="flex items-center gap-1">
                                            <i data-lucide="clock" class="w-3 h-3"></i> {{ element.time }}
                                        </div>
                                        <div v-if="element.ticket" class="flex items-center gap-1">
                                            <i data-lucide="ticket" class="w-3 h-3"></i> {{ element.ticket }}
                                        </div>
                                    </div>
                                    <p class="mt-2 text-xs text-zinc-400 leading-relaxed">{{ element.notes }}</p>
                                    
                                    <!-- 刪除按鈕 -->
                                    <button @click="deleteItem(index)" class="absolute -top-2 -right-2 bg-red-100 text-red-500 rounded-full p-1 opacity-0 hover:opacity-100 transition-opacity">
                                        <i data-lucide="x" class="w-3 h-3"></i>
                                    </button>
                                </div>
                            </div>
                        </template>
                    </draggable>

                    <!-- 新增行程按鈕 -->
                    <button @click="showAddModal = true" class="fixed bottom-24 right-6 w-14 h-14 bg-[#0c4a6e] text-white rounded-full shadow-2xl flex items-center justify-center z-50">
                        <i data-lucide="plus" class="w-8 h-8"></i>
                    </button>
                </section>

                <!-- 2. 資訊 (Info) -->
                <section v-if="currentTab === 'info'" class="space-y-4">
                    <!-- 匯率換算 -->
                    <div class="bg-white rounded-3xl p-6 jp-shadow">
                        <h2 class="text-xl font-black mb-4 flex items-center gap-2 text-[#0c4a6e]">
                            <i data-lucide="refresh-cw" class="w-5 h-5"></i> 匯率換算 (NOK → TWD)
                        </h2>
                        <div class="flex items-center gap-4">
                            <input type="number" v-model="currencyAmount" placeholder="輸入挪威克朗" 
                                   class="w-full bg-zinc-50 border-none rounded-2xl p-4 focus:ring-2 focus:ring-blue-200">
                            <i data-lucide="arrow-right" class="text-zinc-300"></i>
                            <div class="w-full bg-blue-50 text-blue-600 rounded-2xl p-4 font-black text-center">
                                NT$ {{ (currencyAmount * 2.95).toFixed(0) }}
                            </div>
                        </div>
                    </div>

                    <!-- 航班資訊 -->
                    <div class="bg-[#0c4a6e] rounded-[32px] p-6 text-white jp-shadow relative overflow-hidden">
                        <div class="absolute right-[-20px] top-[-20px] opacity-10 rotate-12">
                            <i data-lucide="plane" class="w-32 h-32"></i>
                        </div>
                        <div class="flex justify-between items-center mb-6">
                            <div>
                                <div class="text-xs opacity-60">CX 451</div>
                                <div class="text-3xl font-black">TPE</div>
                                <div class="text-sm">Taipei</div>
                            </div>
                            <div class="flex flex-col items-center flex-1 px-4">
                                <div class="text-[10px] mb-1">2h 15m</div>
                                <div class="w-full border-t border-dashed border-white/40 relative">
                                    <i data-lucide="plane" class="w-4 h-4 absolute top-[-8px] left-[50%] -translate-x-1/2 rotate-90"></i>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-xs opacity-60">19:40 - 21:55</div>
                                <div class="text-3xl font-black">HKG</div>
                                <div class="text-sm">Hong Kong</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 住宿資訊 -->
                    <div class="bg-white rounded-3xl p-5 jp-shadow space-y-4">
                        <h2 class="text-lg font-black text-[#0c4a6e] border-b pb-2">住宿飯店</h2>
                        <div v-for="hotel in hotels" :key="hotel.name" class="flex gap-4">
                            <div class="bg-orange-50 text-orange-500 p-3 rounded-2xl h-fit"><i data-lucide="hotel"></i></div>
                            <div class="flex-1">
                                <div class="font-bold">{{ hotel.name }}</div>
                                <div class="text-xs text-zinc-400 mt-1">{{ hotel.address }}</div>
                                <div class="flex gap-2 mt-2">
                                    <a :href="'tel:'+hotel.phone" class="text-[10px] bg-zinc-100 px-3 py-1 rounded-full font-bold">打電話</a>
                                    <button @click="openNavigation(hotel.address)" class="text-[10px] bg-blue-100 text-blue-600 px-3 py-1 rounded-full font-bold">導航</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 3. 購物清單 (Shopping) -->
                <section v-if="currentTab === 'shopping'" class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div v-for="(item, idx) in shoppingList" :key="idx" class="bg-white rounded-[24px] overflow-hidden jp-shadow border border-white">
                            <div class="h-32 bg-zinc-100 flex items-center justify-center overflow-hidden">
                                <img v-if="item.image" :key="item.image" :src="item.image" class="w-full h-full object-cover">
                                <i v-else data-lucide="camera" class="text-zinc-300"></i>
                            </div>
                            <div class="p-3">
                                <div class="font-bold text-sm">{{ item.name }}</div>
                                <div class="text-[10px] text-zinc-400 mt-1">預算: {{ item.price }} NOK</div>
                            </div>
                        </div>
                    </div>
                    <button @click="addItemToShopping" class="fixed bottom-24 right-6 w-14 h-14 bg-emerald-600 text-white rounded-full shadow-2xl flex items-center justify-center z-50">
                        <i data-lucide="plus" class="w-8 h-8"></i>
                    </button>
                </section>

                <!-- 4. 花費 (Expenses) -->
                <section v-if="currentTab === 'expenses'" class="space-y-4">
                    <div class="bg-gradient-to-br from-blue-600 to-indigo-700 rounded-[32px] p-6 text-white jp-shadow mb-6">
                        <div class="text-xs opacity-70">總花費估算</div>
                        <div class="text-4xl font-black mt-1">¥ {{ totalExpenses.toLocaleString() }}</div>
                        <div class="mt-4 text-xs bg-white/20 p-2 rounded-xl inline-block">約 NT$ {{ (totalExpenses * 0.22).toLocaleString() }}</div>
                    </div>
                    
                    <div class="space-y-3">
                        <div v-for="exp in expenses" :key="exp.name" class="bg-white rounded-2xl p-4 flex justify-between items-center jp-shadow">
                            <div class="flex items-center gap-3">
                                <div class="bg-zinc-100 p-2 rounded-lg text-zinc-500"><i :data-lucide="getExpIcon(exp.category)" class="w-4 h-4"></i></div>
                                <div>
                                    <div class="font-bold text-sm">{{ exp.name }}</div>
                                    <div class="text-[10px] text-zinc-400">{{ exp.date }} · {{ exp.method }}</div>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="font-black text-zinc-800">¥ {{ exp.amount }}</div>
                                <div class="text-[10px] text-zinc-400">{{ exp.category }}</div>
                            </div>
                        </div>
                    </div>
                    <button @click="addExpense" class="fixed bottom-24 right-6 w-14 h-14 bg-indigo-600 text-white rounded-full shadow-2xl flex items-center justify-center z-50">
                        <i data-lucide="plus" class="w-8 h-8"></i>
                    </button>
                </section>

            </div>
        </main>

        <!-- 底部導航標籤 (輔助) -->
        <nav class="fixed bottom-0 left-0 right-0 bg-white/80 backdrop-blur-lg border-t border-zinc-200 flex justify-around py-4 pb-safe z-40">
            <button v-for="tab in tabs" @click="currentTab = tab.id" :class="['flex flex-col items-center gap-1 transition-all', currentTab === tab.id ? 'text-[#0c4a6e]' : 'text-zinc-300']">
                <i :data-lucide="tab.icon" class="w-6 h-6"></i>
                <span class="text-[10px] font-black">{{ tab.label }}</span>
            </button>
        </nav>
    </div>

    <script>
        const { createApp, ref, onMounted, watch, computed } = Vue;

        createApp({
            components: {
                draggable: window.vuedraggable
            },
            setup() {
                const currentTab = ref('itinerary');
                const selectedDayIndex = ref(0);
                const currencyAmount = ref(100);

                const tabs = [
                    { id: 'itinerary', label: '行程', icon: 'map-pin' },
                    { id: 'info', label: '資訊', icon: 'info' },
                    { id: 'shopping', label: '清單', icon: 'shopping-basket' },
                    { id: 'expenses', label: '花費', icon: 'banknote' }
                ];

                const travelDays = [
                    { date: '22', week: 'Thu' }, { date: '23', week: 'Fri' },
                    { date: '24', week: 'Sat' }, { date: '25', week: 'Sun' },
                    { date: '26', week: 'Mon' }, { date: '27', week: 'Tue' }
                ];

                const itineraryData = ref({
                    0: [
                        { id: 1, category: '航班', name: 'CX 451 桃園 → 香港', time: '19:40', ticket: 'PNR: YSOGJD', notes: '提早 2.5 小時到 T1', travelTime: '' },
                        { id: 2, category: '住宿', name: '香港機場酒店', time: '22:30', notes: '過境休息', travelTime: '10 min' }
                    ],
                    1: [
                        { id: 3, category: '景點', name: '特羅姆瑟大教堂', time: '14:00', ticket: '免費', notes: '世界最北的大教堂', travelTime: '20 min' },
                        { id: 4, category: '美食', name: 'Fiskekompaniet', time: '18:30', notes: '當地必吃海鮮', travelTime: '5 min' }
                    ]
                });

                const currentDayItems = computed({
                    get: () => itineraryData.value[selectedDayIndex.value] || [],
                    set: (val) => { itineraryData.value[selectedDayIndex.value] = val; }
                });

                const hotels = [
                    { name: "Modern Stunning House", address: "Balsfjordgata 41B, Tromsø", phone: "+47 4119 9112" }
                ];

                const expenses = ref([
                    { name: '機票餘額', category: '交通', amount: 45000, date: '2026-01-22', method: '信用卡' },
                    { name: '晚餐海鮮', category: '飲食', amount: 8500, date: '2026-01-23', method: '現金' }
                ]);

                const shoppingList = ref([
                    { name: '挪威羊毛衣', price: 1200, image: 'https://images.unsplash.com/photo-1591047139829-d91aecb6caea?w=300' },
                    { name: '魚子醬牙膏', price: 80, image: '' }
                ]);

                const totalExpenses = computed(() => expenses.value.reduce((sum, item) => sum + item.amount, 0));

                const openNavigation = (location) => {
                    window.open(`https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(location)}`, '_blank');
                };

                const deleteItem = (idx) => {
                    if(confirm("確定要刪除這項行程嗎？")) {
                        currentDayItems.value.splice(idx, 1);
                    }
                };

                const getCategoryColor = (cat) => {
                    switch(cat) {
                        case '航班': return 'border-blue-500';
                        case '住宿': return 'border-orange-400';
                        case '景點': return 'border-emerald-500';
                        case '美食': return 'border-rose-400';
                        default: return 'border-zinc-300';
                    }
                };

                const getCategoryIcon = (cat) => {
                    switch(cat) {
                        case '航班': return 'plane';
                        case '住宿': return 'hotel';
                        case '景點': return 'camera';
                        case '美食': return 'utensils';
                        default: return 'map-pin';
                    }
                };

                const getExpIcon = (cat) => {
                    switch(cat) {
                        case '交通': return 'car';
                        case '飲食': return 'coffee';
                        default: return 'credit-card';
                    }
                };

                onMounted(() => {
                    lucide.createIcons();
                });

                watch([currentTab, selectedDayIndex, itineraryData], () => {
                    setTimeout(() => lucide.createIcons(), 10);
                }, { deep: true });

                return {
                    currentTab, tabs, travelDays, selectedDayIndex, itineraryData, 
                    currentDayItems, hotels, currencyAmount, expenses, totalExpenses,
                    shoppingList, openNavigation, getCategoryColor, getCategoryIcon,
                    getExpIcon, deleteItem
                };
            }
        }).mount('#app');
    </script>
</body>
</html>