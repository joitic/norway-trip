<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>挪威冬日旅程 2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;700;900&display=swap');
        [v-cloak] { display: none; }
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f0f4f8; margin: 0; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .card-shadow { box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .active-card { background-color: #000000 !important; color: #ffffff !important; }
        .active-card .text-zinc-400 { color: rgba(255,255,255,0.5) !important; }
        .active-card .icon-bg { background-color: rgba(255,255,255,0.2) !important; }
        .active-card .route-badge { background-color: #ffffff; color: #000000; }
        .active-card .route-text { color: #7dd3fc; }
        .content-up { border-top-left-radius: 32px; border-top-right-radius: 32px; background-color: #f0f4f8; position: relative; top: -30px; }
        input { outline: none; -webkit-appearance: none; }
    </style>
</head>
<body>
    <div id="app" v-cloak>
        <header class="relative h-[250px] w-full overflow-hidden">
            <img src="./banner.jpg" class="w-full h-full object-cover" alt="Norway" onerror="this.src='https://images.unsplash.com/photo-1520106212299-d99c443e4568?auto=format&fit=crop&w=1920&q=80'">
            <div class="absolute inset-0 bg-black/10"></div>
            <div class="absolute bottom-16 right-4 flex gap-2">
                <button v-for="tab in tabs" :key="tab.id" @click="currentTab = tab.id"
                    :class="['p-3 rounded-full transition-all duration-300 shadow-xl backdrop-blur-md', currentTab === tab.id ? 'bg-[#0c4a6e] text-white scale-110' : 'bg-white/80 text-[#0c4a6e]']">
                    <i :data-lucide="tab.icon" class="w-5 h-5"></i>
                </button>
            </div>
        </header>

        <main class="content-up px-4 pb-32">
            <!-- 1. 每日行程表 -->
            <section v-show="currentTab === 'itinerary'">
                <div class="flex items-center justify-between mb-4 pt-4 px-1">
                    <div class="flex items-center gap-3">
                        <div class="bg-white p-3 rounded-2xl border border-zinc-200 shadow-sm"><i data-lucide="calendar" class="w-6 h-6 text-zinc-600"></i></div>
                        <div>
                            <div class="text-[10px] text-zinc-400 font-black uppercase tracking-widest">{{ travelDays[selectedDayIndex].dateLabel }}</div>
                            <div class="text-xl font-black text-zinc-800">{{ travelDays[selectedDayIndex].title }}</div>
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <button @click="prevDay" class="p-2 bg-white rounded-full border border-zinc-200 active:bg-zinc-100"><i data-lucide="chevron-left" class="w-6 h-6"></i></button>
                        <button @click="nextDay" class="p-2 bg-white rounded-full border border-zinc-200 active:bg-zinc-100"><i data-lucide="chevron-right" class="w-6 h-6"></i></button>
                    </div>
                </div>

                <div class="flex overflow-x-auto hide-scrollbar gap-2 mb-6">
                    <button v-for="(day, index) in travelDays" :key="index" @click="selectedDayIndex = index"
                         :class="['flex-shrink-0 px-4 py-2 rounded-full border text-[13px] font-black transition-all whitespace-nowrap', selectedDayIndex === index ? 'bg-black text-white border-black shadow-lg scale-105' : 'bg-white text-zinc-400 border-zinc-200']">
                        {{ day.label }}
                    </button>
                </div>

                <div class="space-y-4">
                    <div v-for="item in currentDayItems" :key="item.id" @click="handleCardClick(item)"
                         :class="['relative rounded-[28px] p-5 card-shadow transition-all active:scale-[0.97]', selectedCardId === item.id ? 'active-card' : 'bg-white text-zinc-900 border border-zinc-50']">
                        <div class="flex justify-between items-start mb-2">
                            <div class="flex items-center gap-3">
                                <div :class="['p-2 rounded-xl icon-bg shadow-sm', selectedCardId === item.id ? 'bg-white/20' : 'bg-zinc-100']"><i :data-lucide="getCategoryIcon(item.category)" class="w-5 h-5 text-zinc-600"></i></div>
                                <div class="text-[10px] font-black uppercase tracking-widest text-zinc-400">{{ item.category }}</div>
                            </div>
                            <div class="text-xs font-bold">{{ item.time }}</div>
                        </div>
                        <div class="ml-12">
                            <h3 class="text-lg font-black leading-tight">{{ item.name }}</h3>
                            <div v-if="item.direction" class="mt-2 flex items-start gap-2">
                                <span class="route-badge mt-0.5 flex-shrink-0 bg-blue-600 text-white text-[9px] px-1.5 py-0.5 rounded font-black uppercase">路線</span>
                                <span class="route-text text-xs font-black text-blue-700 leading-snug">{{ item.direction }}</span>
                            </div>
                            <div class="text-xs font-medium mt-1 opacity-60">{{ item.place }}</div>
                            <div v-if="item.reminders" class="mt-4 p-4 rounded-2xl border text-[11px] leading-relaxed font-medium transition-all" :class="selectedCardId === item.id ? 'bg-white/10 border-white/20 text-white' : 'bg-amber-50 border-amber-100 text-amber-900'">
                                <div class="flex items-center gap-1 font-black mb-1 opacity-80 uppercase tracking-widest"><i data-lucide="info" class="w-3 h-3"></i> 長輩小叮嚀</div>
                                <p class="whitespace-pre-line">{{ item.reminders }}</p>
                            </div>
                        </div>
                        <div v-if="['航班', '火車', '乘船', '活動'].includes(item.category)" class="absolute right-5 top-5 opacity-20"><i data-lucide="chevron-right" class="w-4 h-4"></i></div>
                    </div>

                    <div v-if="lodgingForToday" @click="goToHotel(lodgingForToday.id)" class="relative rounded-[28px] p-5 card-shadow bg-white text-zinc-900 border border-zinc-100 active:scale-[0.97]">
                        <div class="absolute top-5 right-6 text-[10px] font-bold text-zinc-400">夜宿</div>
                        <div class="flex items-center gap-3 mb-2">
                            <div class="p-2 rounded-xl bg-zinc-100"><i data-lucide="hotel" class="w-5 h-5 text-zinc-600"></i></div>
                            <div class="text-[10px] font-black uppercase tracking-widest text-zinc-400">住宿</div>
                        </div>
                        <div class="ml-12">
                            <h3 class="text-lg font-black leading-tight">{{ lodgingForToday.name }}</h3>
                            <div class="text-xs font-bold mt-1 text-zinc-800">{{ lodgingForToday.locationLabel }}</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 2. 資訊頁 -->
            <section v-show="currentTab === 'info'" class="space-y-6 pt-4">
                <div class="flex bg-zinc-200 p-1 rounded-2xl shadow-inner mx-2">
                    <button @click="infoSubTab = 'flight'" :class="['flex-1 py-3 rounded-xl text-[10px] font-black transition-all', infoSubTab === 'flight' ? 'bg-white shadow-sm text-black' : 'text-zinc-500']">航班登機證</button>
                    <button @click="infoSubTab = 'ticket'" :class="['flex-1 py-3 rounded-xl text-[10px] font-black transition-all', infoSubTab === 'ticket' ? 'bg-white shadow-sm text-black' : 'text-zinc-500']">交通與票券</button>
                    <button @click="infoSubTab = 'hotel'" :class="['flex-1 py-3 rounded-xl text-[10px] font-black transition-all', infoSubTab === 'hotel' ? 'bg-white shadow-sm text-black' : 'text-zinc-500']">住宿飯店</button>
                </div>
                <div v-if="infoSubTab !== 'hotel'" class="flex overflow-x-auto hide-scrollbar gap-2 px-4 py-2">
                    <button v-for="p in people" :key="p.id" @click="activePersonId = p.id" :class="['flex-shrink-0 px-5 py-2 rounded-full text-xs font-bold border transition-all', activePersonId === p.id ? 'bg-black text-white shadow-md' : 'bg-white text-zinc-400 border-zinc-200']">{{ p.name }}</button>
                </div>

                <div v-if="infoSubTab === 'flight'" class="space-y-4 px-2">
                    <div class="bg-white rounded-[32px] p-1 shadow-2xl border border-white overflow-hidden">
                        <div class="bg-[#0c4a6e] p-6 text-white rounded-t-[32px]">
                            <div class="flex overflow-x-auto hide-scrollbar gap-2">
                                <button v-for="(f, idx) in flights" :key="f.no" @click="activeFlightIndex = idx" :class="['px-4 py-2 rounded-xl flex-shrink-0 text-[10px] font-black border transition-all', activeFlightIndex === idx ? 'bg-white text-[#0c4a6e]' : 'bg-white/10 text-white border-white/20']">{{ f.no }}</button>
                            </div>
                        </div>
                        <div class="p-6">
                            <div :class="['rounded-3xl p-6 text-white mb-6 shadow-xl relative overflow-hidden', activeFlight.color]">
                                <div class="text-2xl font-black italic mb-6 uppercase tracking-tighter">{{ activeFlight.no }}</div>
                                <div class="flex justify-between items-center border-b border-white/20 pb-4 mb-4 text-left">
                                    <div><div class="text-3xl font-black">{{ activeFlight.from }}</div><div class="text-xs">{{ activeFlight.depTime }}</div></div>
                                    <i data-lucide="move-right" class="opacity-40"></i>
                                    <div class="text-right"><div class="text-3xl font-black">{{ activeFlight.to }}</div><div class="text-xs">{{ activeFlight.arrTime }}</div></div>
                                </div>
                                <div class="flex justify-between items-end">
                                    <div><div class="text-[10px] opacity-60 font-black">PASSENGER</div><div class="text-lg font-black leading-none">{{ activePersonName }}</div></div>
                                    <div class="text-right"><div class="text-[10px] opacity-60 font-black">PNR</div><div class="text-xl font-mono font-black tracking-tighter">{{ activeFlight.pnrGroup[activePersonId] }}</div></div>
                                </div>
                            </div>
                            <div class="text-center bg-zinc-50 p-6 rounded-[32px] border-2 border-dashed border-zinc-200">
                                <img :src="`https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${activeFlight.no}_${activePersonId}`" class="w-40 h-40 mx-auto shadow-md rounded-2xl bg-white p-2">
                            </div>
                        </div>
                    </div>
                </div>

                <div v-if="infoSubTab === 'ticket'" class="space-y-4 px-2">
                    <div class="bg-white rounded-[32px] p-1 shadow-2xl border border-white overflow-hidden text-center">
                        <div class="bg-emerald-700 p-6 text-white rounded-t-[32px]">
                            <div class="flex overflow-x-auto hide-scrollbar gap-2">
                                <button v-for="(t, idx) in specialTickets" :key="t.btnName" @click="activeTicketIndex = idx" :class="['px-4 py-2 rounded-xl flex-shrink-0 text-[10px] font-black border transition-all', activeTicketIndex === idx ? 'bg-white text-emerald-800 border-white shadow-sm' : 'bg-white/10 text-white border-white/20']">{{ t.btnName }}</button>
                            </div>
                        </div>
                        <div class="p-6">
                            <div class="bg-emerald-600 rounded-3xl p-6 text-white mb-6 shadow-xl relative overflow-hidden text-left">
                                <div class="flex justify-between items-start mb-4">
                                    <div><div class="text-[10px] font-black uppercase opacity-60">{{ activeTicket.kind }}</div><h2 class="text-xl font-black mt-1">{{ activeTicket.name }}</h2></div>
                                    <i :data-lucide="activeTicket.icon" class="w-8 h-8 opacity-30"></i>
                                </div>
                                <div class="mt-8 pt-6 border-t border-white/20 flex justify-between items-end text-left">
                                    <div class="font-black">{{ activePersonName }}</div>
                                    <div class="text-right"><div class="text-[10px] opacity-60 font-black">編號/代碼</div><div class="font-mono text-lg font-black tracking-tighter">{{ activeTicket.code || 'N/A' }}</div></div>
                                </div>
                            </div>
                            <div class="bg-zinc-50 p-6 rounded-[32px] border-2 border-dashed border-zinc-200 flex flex-col items-center justify-center">
                                <div class="w-full bg-white p-4 rounded-2xl shadow-md flex justify-center items-center">
                                    <img v-if="activeTicket.qrKey" :src="`${qrBase}/${activeTicket.qrKey}_${activePersonId}.png`" 
                                         class="w-full max-w-[320px] h-auto object-contain rounded-lg mx-auto" 
                                         onerror="this.src='https://via.placeholder.com/300x150?text=Scan+Ticket'">
                                </div>
                                <div v-if="activeTicket.notes" class="mt-6 p-4 bg-white text-[11px] text-zinc-600 rounded-2xl text-left border border-zinc-100 whitespace-pre-line leading-relaxed w-full">{{ activeTicket.notes }}</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div v-if="infoSubTab === 'hotel'" class="px-2 space-y-4">
                    <div v-for="hotel in hotels" :key="hotel.id" :id="'hotel-' + hotel.id" class="bg-white rounded-[32px] overflow-hidden shadow-xl border border-white">
                        <div class="bg-orange-500 p-6 text-white"><h2 class="text-xl font-black tracking-tight italic">{{ hotel.name }}</h2></div>
                        <div class="p-6 space-y-4 text-sm font-bold">
                            <div class="flex items-center gap-3 text-zinc-500"><i data-lucide="map-pin" class="w-4 h-4"></i> {{ hotel.locationLabel }}</div>
                            <div class="flex items-center gap-3 text-zinc-500"><i data-lucide="ticket" class="w-4 h-4"></i> {{ hotel.code }}</div>
                            <div class="flex items-start gap-3 text-zinc-800 leading-snug"><i data-lucide="navigation" class="w-4 h-4 text-blue-500 mt-1"></i> {{ hotel.address }}</div>
                            <button @click="openNavigation(hotel.address)" class="text-blue-600 text-xs underline font-black uppercase">一鍵導航</button>
                            <div class="bg-amber-50 p-4 rounded-2xl text-amber-900 border border-amber-100 leading-relaxed whitespace-pre-line text-[11px]">{{ hotel.notes }}</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 3. 清單頁 -->
            <section v-show="currentTab === 'shopping'" class="space-y-6 pt-4">
                <div class="bg-white rounded-[32px] p-6 card-shadow border border-zinc-100">
                    <h2 class="text-xl font-black text-rose-600 mb-4 flex items-center gap-2"><i data-lucide="alert-circle"></i> 待付尾款 (尚未結清)</h2>
                    <div class="space-y-4 text-left">
                        <div class="p-4 bg-rose-50 border border-rose-100 rounded-2xl">
                            <div class="font-black text-rose-900 text-base">羅浮敦住宿尾款 (住宿2)</div>
                            <div class="text-sm text-rose-700 font-bold mt-1">需付金額: NOK 24,944 (現場付)</div>
                        </div>
                        <div class="p-4 bg-zinc-50 border border-zinc-100 rounded-2xl">
                            <div class="font-black text-zinc-800 font-bold tracking-tight text-base">各區巴士共同費用 (7趟/人)</div>
                            <div class="text-xs text-zinc-400 font-bold mt-1">預計每人 NOK 350 ~ 500。</div>
                        </div>
                    </div>
                </div>
                <div class="py-10 text-center text-zinc-300"><i data-lucide="shopping-basket" class="w-16 h-16 mx-auto"></i><p class="mt-4 font-black">其餘想買物品清單建置中...</p></div>
            </section>

            <!-- 4. 花費頁 -->
            <section v-show="currentTab === 'expenses'" class="space-y-6 pt-4 px-1">
                <div class="bg-white rounded-[32px] p-6 card-shadow border border-zinc-100">
                    <h2 class="text-lg font-black text-[#0c4a6e] mb-4 flex items-center gap-2"><i data-lucide="refresh-cw" class="w-5 h-5"></i> 快速匯率換算</h2>
                    <div class="space-y-3">
                        <div class="bg-blue-50 p-4 rounded-2xl flex flex-col gap-1">
                            <div class="text-[10px] font-black text-blue-400 uppercase tracking-widest text-left">挪威克朗 NOK ➔ 台幣</div>
                            <div class="flex items-center gap-3">
                                <input type="number" v-model="calcNok" class="w-2/3 bg-white rounded-xl p-2 font-black text-lg shadow-sm border-none" placeholder="金額">
                                <div class="font-black text-blue-600">≈ ${{ (calcNok * 3.0).toFixed(0) }}</div>
                            </div>
                        </div>
                        <div class="bg-indigo-50 p-4 rounded-2xl flex flex-col gap-1">
                            <div class="text-[10px] font-black text-indigo-400 uppercase tracking-widest text-left">歐元 EUR ➔ 台幣</div>
                            <div class="flex items-center gap-3">
                                <input type="number" v-model="calcEur" class="w-2/3 bg-white rounded-xl p-2 font-black text-lg shadow-sm border-none" placeholder="金額">
                                <div class="font-black text-indigo-600">≈ ${{ (calcEur * 35.0).toFixed(0) }}</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-[32px] p-6 card-shadow border border-blue-100">
                    <div class="flex justify-between items-center mb-4 text-left">
                        <h2 class="text-lg font-black text-[#0c4a6e] flex items-center gap-2"><i data-lucide="edit-3" class="w-5 h-5"></i> 共同支出 (NOK)</h2>
                        <div class="bg-blue-600 text-white text-xs px-3 py-1 rounded-full font-black">NOK {{ totalNok.toLocaleString() }}</div>
                    </div>
                    <div class="space-y-3">
                        <input v-model="newNokExp.name" type="text" placeholder="項目 (如: 超市)" class="w-full bg-zinc-50 rounded-xl p-3 text-sm font-bold border-none">
                        <div class="flex gap-2">
                            <input v-model.number="newNokExp.amount" type="number" placeholder="金額" class="w-full bg-zinc-50 rounded-xl p-3 text-sm font-bold border-none">
                            <button @click="addExpense('nok')" class="bg-[#0c4a6e] text-white px-5 rounded-xl font-black text-sm active:scale-95 transition-all shadow-md">+</button>
                        </div>
                        <div class="space-y-2 mt-2">
                            <div v-for="(ex, i) in nokList" :key="i" class="flex justify-between text-xs font-bold text-zinc-600 bg-zinc-50 p-3 rounded-lg border-l-4 border-blue-400">
                                <span>{{ ex.name }}</span>
                                <div class="flex items-center gap-2"><span>{{ ex.amount }}</span><button @click="removeExpense('nok', i)" class="text-rose-400">×</button></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-[32px] p-6 card-shadow border border-indigo-100">
                    <div class="flex justify-between items-center mb-4 text-left">
                        <h2 class="text-lg font-black text-indigo-800 flex items-center gap-2"><i data-lucide="edit-3" class="w-5 h-5"></i> 共同支出 (EUR)</h2>
                        <div class="bg-indigo-600 text-white text-xs px-3 py-1 rounded-full font-black">€ {{ totalEur.toLocaleString() }}</div>
                    </div>
                    <div class="space-y-3 text-left">
                        <input v-model="newEurExp.name" type="text" placeholder="項目 (如: 晚餐)" class="w-full bg-zinc-50 rounded-xl p-3 text-sm font-bold border-none">
                        <div class="flex gap-2 text-left">
                            <input v-model.number="newEurExp.amount" type="number" placeholder="金額" class="w-full bg-zinc-50 rounded-xl p-3 text-sm font-bold border-none text-left">
                            <button @click="addExpense('eur')" class="bg-indigo-700 text-white px-5 rounded-xl font-black text-sm active:scale-95 transition-all shadow-md text-left">+</button>
                        </div>
                        <div class="space-y-2 mt-2 text-left">
                            <div v-for="(ex, i) in eurList" :key="i" class="flex justify-between text-xs font-bold text-zinc-600 bg-zinc-50 p-3 rounded-lg border-l-4 border-indigo-400">
                                <span>{{ ex.name }}</span>
                                <div class="flex items-center gap-2"><span>€ {{ ex.amount }}</span><button @click="removeExpense('eur', i)" class="text-rose-400 text-left">×</button></div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <nav class="fixed bottom-0 left-0 right-0 bg-white/90 backdrop-blur-xl border-t border-zinc-200 flex justify-around py-4 pb-10 z-50">
            <button v-for="tab in tabs" @click="currentTab = tab.id" :class="['flex flex-col items-center gap-1 transition-all', currentTab === tab.id ? 'text-black scale-110' : 'text-zinc-300']">
                <i :data-lucide="tab.icon" class="w-6 h-6"></i>
                <span class="text-[10px] font-black uppercase tracking-widest">{{ tab.label }}</span>
            </button>
        </nav>
    </div>

    <script>
        const { createApp, ref, onMounted, watch, computed } = Vue;
        createApp({
            setup() {
                const currentTab = ref('itinerary');
                const infoSubTab = ref('flight');
                const selectedDayIndex = ref(0);
                const activeFlightIndex = ref(0);
                const activeTicketIndex = ref(0);
                const activePersonId = ref('p1');
                const selectedCardId = ref(null);
                const calcNok = ref(0);
                const calcEur = ref(0);
                const qrBase = "https://res.cloudinary.com/dpaxzwizz/image/upload/v1766390992/trip-qr";
                const nokList = ref([]);
                const eurList = ref([]);
                const newNokExp = ref({ name: '', amount: null });
                const newEurExp = ref({ name: '', amount: null });

                const tabs = [
                    { id: 'itinerary', label: '行程', icon: 'map-pin' },
                    { id: 'info', label: '資訊', icon: 'info' },
                    { id: 'shopping', label: '清單', icon: 'shopping-basket' },
                    { id: 'expenses', label: '花費', icon: 'banknote' }
                ];

                const people = [{ id: 'p1', name: '林憲良' }, { id: 'p2', name: '陳慧敏' }, { id: 'p3', name: '陳慧美' }, { id: 'p4', name: '陳志宏' }, { id: 'p5', name: '陳淑蘭' }, { id: 'p6', name: '楊謦瑜' }, { id: 'p7', name: '楊謦寧' }];

                const hotels = [
                    { id: 'h1', name: 'Modern House View', locationLabel: '特羅姆瑟 · 1/23-1/29', code: 'Booking: 5533006813', address: 'Balsfjordgata 41B, Tromsø', phone: '+47 4119 9112', notes: '不用鑰匙，以密碼進入。' },
                    { id: 'h2', name: 'Thon Hotel Lofoten', locationLabel: '斯沃爾韋爾 · 1/29–2/3', code: 'Ref: 424027497', address: 'Torget, Svolvær', phone: '+47 7604 9000', notes: '餘款NOK 24,944現場付。' },
                    { id: 'h3', name: 'Citybox Bergen City', locationLabel: '卑爾根 · 2/3–2/5', code: 'Ref: 285043', address: 'Nygårdsgaten 31, Bergen', phone: '+47 5531 2500', notes: '已全額付款。' },
                    { id: 'h4', name: 'Conscious Hotel Museum Square', locationLabel: '阿姆斯特丹 · 2/5–2/9', code: 'Ref: 285043', address: 'De Lairessestraat 7, Amsterdam', phone: '+31 20 820 3333', notes: '已全額付款。' }
                ];

                const travelDays = Array.from({length: 20}, (_, i) => {
                    const dates = ['1/22','1/23','1/24','1/25','1/26','1/27','1/28','1/29','1/30','1/31','2/1','2/2','2/3','2/4','2/5','2/6','2/7','2/8','2/9','2/10'];
                    const titles = ['出發 / 抵達','抵達 / 景點','自由時間','自由時間','狗拉雪橇冒險','自由時間','自由時間','移動日','自由時間','自由時間','自由時間','自由時間','移動日','挪威縮影','移動日','博物館','自由行程','自由行程','景點 / 返程','返程'];
                    return { label: `D${i+1} · ${dates[i]}`, date: dates[i], title: titles[i], dateLabel: `D${i+1} · ${dates[i]}` };
                });

                const itineraryData = {
                    0: [{ id: 101, category: '航班', name: 'CX 451 桃園 → 香港', time: '19:40-21:45', place: 'TPE T1 → HKG T1' }, { id: 102, category: '航班', name: 'LX 139 香港 → 蘇黎世', time: '23:30-06:10+1', place: 'HKG T1 → ZRH', reminders: '帶外套、上廁所。' }],
                    1: [{ id: 201, category: '航班', name: 'LX 8318 蘇黎世 → 特羅姆瑟', time: '08:15–12:15', place: 'ZRH → TOS' }, { id: 202, category: '交通', name: '40號巴士 (接駁住宿)', time: '13:13–13:36', place: 'Airport → Bjørnøygata', direction: '40 Tromsø museum via sentrum', reminders: '看到 Polaria 準備下車。' }],
                    4: [{ id: 501, category: '活動', name: '狗拉雪橇冒險', time: '09:30–16:30', place: 'Samuel Arnesens gate 5, Tromso', reminders: '9:15前在 Tromso Havn Prostneset 主入口大廳內集合。\n預訂編號: GYGWZA49GG6X\n電話: +47 77710100' }],
                    7: [{ id: 801, category: '交通', name: '33號巴士 → 40號巴士', time: '11:57–12:24', place: '住宿 → 機場', direction: '33 Giæverbukta ➔ 40 Slettaelva', reminders: '1. 先搭 33 到 T4\n2. 走路 1 分鐘到 T3 轉 40 號。' }, { id: 802, category: '航班', name: 'WF 817 特羅姆瑟 → 萊克內斯', time: '14:10–15:10', place: 'TOS → LKN' }, { id: 803, category: '交通', name: '741號巴士 (長途)', time: '16:00–17:25', place: 'Leknes → Svolvær', direction: '741 Svolvær - Leknes', reminders: '車程約 1.5 小時，坐到終點下車。' }],
                    12: [{ id: 1301, category: '交通', name: '749號巴士 → 機場', time: '06:15–06:21', place: 'Svolvær → 機場', direction: '749 Fiskebøl ferjekai' }, { id: 1302, category: '航班', name: 'WF 823 斯沃爾韋爾 → 博多', time: '09:35–10:00', place: 'SVJ → BOO' }, { id: 1303, category: '航班', name: 'WF 1306 博多 → 卑爾根', time: '10:40–13:30', place: 'BOO → BGO' }, { id: 1304, category: '交通', name: '1號巴士 → 住宿', time: '班次密集', place: '機場 → 市區', direction: '1 to Bergen sentrum', reminders: '可 App 購票或刷卡 (NOK 49)。' }],
                    13: [{ id: 1401, category: '火車', name: '卑爾根 → 米達爾', time: '08:08–10:00', place: 'Bergen ➔ Myrdal', reminders: '座位：4車 29~34、37。\nReferansekode: TDT-LX3-IU6。' }, { id: 1402, category: '火車', name: '米達爾 → 弗洛姆', time: '10:15–11:05', place: 'Myrdal ➔ Flåm', reminders: '非對號座，下車去對面，坐第6車離瀑布近。' }, { id: 1403, category: '乘船', name: '納柔依峽灣遊船', time: '14:45–16:45', place: 'Flåm ➔ Gudvangen', reminders: '前 20 分鐘報到。' }, { id: 1404, category: '交通', name: '950號巴士 (往沃斯)', time: '16:50–17:45', place: 'Gudvangen ➔ Voss', direction: '950 to Voss', reminders: '巴士會等船班。' }],
                    14: [{ id: 1501, category: '交通', name: '1號巴士 → 機場', time: '08:03–08:44', place: 'Bergen busstasjon ➔ 機場', direction: '1 to Bergen lufthavn' }, { id: 1502, category: '航班', name: 'KL 1164 卑爾根 → 阿姆斯特丹', time: '10:50–12:35', place: 'BGO ➔ AMS', reminders: '免稅店別逛太晚。' }, { id: 1503, category: '交通', name: '397號巴士 → 住宿', time: '13:27–13:52', place: 'Airport/Plaza ➔ Concertgebouw', direction: '397 P+R Getsewoud Zuid' }],
                    15: [{ id: 1601, category: '活動', name: '梵谷博物館', time: '09:00', place: '阿姆斯特丹', reminders: '09:00 入場，記得領取語音導覽。' }],
                    18: [{ id: 1901, category: '航班', name: 'LX 735 阿姆 → 蘇黎世', time: '20:00–21:30', place: 'AMS → ZRH' }, { id: 1902, category: '航班', name: 'LX 138 蘇黎世 → 香港', time: '22:40–17:45+1', place: 'ZRH → HKG T1', reminders: '轉機緊迫，注意時間！' }],
                    19: [{ id: 2001, category: '航班', name: 'CX 464 香港 → 桃園', time: '19:40–21:20', place: 'HKG T1 → TPE T1' }]
                };

                const pnr_all = { p1: 'YSOGJD', p2: 'YSOGJD', p3: 'YSK5FZ', p4: 'YSPTBQ', p5: 'YSPTBQ', p6: 'YSK5FZ', p7: 'YSK5FZ' };
                const flights = [
                    { no: 'CX 451', color: 'bg-[#006564]', pnrGroup: pnr_all, from: 'TPE', to: 'HKG', depTime: '19:40', arrTime: '21:55' },
                    { no: 'LX 139', color: 'bg-[#e30613]', pnrGroup: pnr_all, from: 'HKG', to: 'ZRH', depTime: '23:30', arrTime: '06:10' },
                    { no: 'LX 8318', color: 'bg-[#e30613]', pnrGroup: pnr_all, from: 'ZRH', to: 'TOS', depTime: '08:15', arrTime: '12:15' },
                    { no: 'WF 817', color: 'bg-[#003d4c]', pnrGroup: { p1: 'X9Q4SM', p2:'X9Q4SM', p3: 'X9KHZB', p4: 'XAALJP', p5: 'XAALJP', p6: 'X9KHZB', p7: 'X9KHZB' }, from: 'TOS', to: 'LKN', depTime: '14:10', arrTime: '15:10' },
                    { no: 'WF 823', color: 'bg-[#003d4c]', pnrGroup: { p1: 'X9ROLA', p2:'X9ROLA', p3: 'X9YP5Q', p4: 'XA8QXI', p5: 'XA8QXI', p6: 'X9YP5Q', p7: 'X9YP5Q' }, from: 'SVJ', to: 'BOO', depTime: '09:35', arrTime: '10:00' },
                    { no: 'WF 1306', color: 'bg-[#003d4c]', pnrGroup: { p1: 'X9ROLA', p2:'X9ROLA', p3: 'X9YP5Q', p4: 'XA8QXI', p5: 'XA8QXI', p6: 'X9YP5Q', p7: 'X9YP5Q' }, from: 'BOO', to: 'BGO', depTime: '10:40', arrTime: '13:30' },
                    { no: 'KL 1164', color: 'bg-[#00A1DE]', pnrGroup: { p1: 'X9XWU4', p2:'X9XWU4', p3: 'XA4TCU', p4: 'XAEP2U', p5: 'XAEP2U', p6: 'XA4TCU', p7: 'XA4TCU' }, from: 'BGO', to: 'AMS', depTime: '10:50', arrTime: '12:35' },
                    { no: 'LX 735', color: 'bg-[#e30613]', pnrGroup: pnr_all, from: 'AMS', to: 'ZRH', depTime: '20:00', arrTime: '21:30' },
                    { no: 'LX 138', color: 'bg-[#e30613]', pnrGroup: pnr_all, from: 'ZRH', to: 'HKG', depTime: '22:40', arrTime: '17:45' },
                    { no: 'CX 464', color: 'bg-[#006564]', pnrGroup: pnr_all, from: 'HKG', to: 'TPE', depTime: '19:40', arrTime: '21:20' }
                ];

                const specialTickets = [
                    { btnName: '卑爾根火車', kind: '火車票', name: 'Bergen ➔ Myrdal', icon: 'train', qrKey: 'tr1', code: 'TDT-LX3-IU6', notes: '座位：4車 29~34、37' },
                    { btnName: '峽灣遊船', kind: '船票', name: '納柔依峽灣遊船', icon: 'ship', qrKey: 'boat1', notes: '請於開船前 20 分鐘報到。' },
                    { btnName: '狗拉雪橇', kind: '活動門票', name: '狗拉雪橇冒險', icon: 'ticket', qrKey: 'a2', code: 'GYGWZA49GG6X', notes: '9:15前在 Tromso Havn Prostneset 集合。' },
                    { btnName: '梵谷博物館', kind: '門票', name: '梵谷博物館', icon: 'ticket', qrKey: 'a1', code: 'FQV282131', notes: '09:00 入場。' }
                ];

                const handleCardClick = (item) => {
                    selectedCardId.value = item.id;
                    if (item.category === '航班') {
                        const idx = flights.findIndex(f => item.name.includes(f.no));
                        if(idx!==-1) { activeFlightIndex.value=idx; infoSubTab.value='flight'; currentTab.value='info'; }
                    } else if (['火車', '乘船', '活動'].includes(item.category)) {
                        let target = 0;
                        if (item.name.includes('米達爾')) target = 0;
                        if (item.name.includes('遊船')) target = 1;
                        if (item.name.includes('狗拉雪橇')) target = 2;
                        if (item.name.includes('梵谷')) target = 3;
                        activeTicketIndex.value = target;
                        infoSubTab.value = 'ticket'; currentTab.value = 'info';
                    }
                };

                const lodgingForToday = computed(() => {
                    const idx = selectedDayIndex.value;
                    if (idx === 0 || idx === 18) return { name: '機上過夜', locationLabel: '飛機上', id: 'in-flight' };
                    if (idx >= 1 && idx <= 6) return hotels[0];
                    if (idx >= 7 && idx <= 11) return hotels[1];
                    if (idx >= 12 && idx <= 13) return hotels[2];
                    if (idx >= 14 && idx <= 17) return hotels[3];
                    return null;
                });

                const totalNok = computed(() => nokList.value.reduce((s, e) => s + (e.amount || 0), 0));
                const totalEur = computed(() => eurList.value.reduce((s, e) => s + (e.amount || 0), 0));
                const addExpense = (type) => {
                    if(type === 'nok' && newNokExp.value.name) { nokList.value.push({...newNokExp.value}); newNokExp.value = { name: '', amount: null }; }
                    if(type === 'eur' && newEurExp.value.name) { eurList.value.push({...newEurExp.value}); newEurExp.value = { name: '', amount: null }; }
                };
                const removeExpense = (type, i) => { if(type==='nok') nokList.value.splice(i,1); else eurList.value.splice(i,1); };

                const activeFlight = computed(() => flights[activeFlightIndex.value]);
                const activeTicket = computed(() => specialTickets[activeTicketIndex.value]);
                const activePersonName = computed(() => people.find(p => p.id === activePersonId.value).name);
                const nextDay = () => { if (selectedDayIndex.value < 19) selectedDayIndex.value++; };
                const prevDay = () => { if (selectedDayIndex.value > 0) selectedDayIndex.value--; };
                const openNavigation = (loc) => window.open(`https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(loc)}`);
                const getCategoryIcon = (cat) => ({ '航班': 'plane', '火車': 'train', '乘船': 'ship', '交通': 'bus', '活動': 'ticket' }[cat] || 'map-pin');
                const currentDayItems = computed(() => itineraryData[selectedDayIndex.value] || []);
                const goToHotel = (id) => { if(id!=='in-flight'){ infoSubTab.value='hotel'; currentTab.value='info'; } };

                onMounted(() => lucide.createIcons());
                watch([currentTab, selectedDayIndex, infoSubTab, activePersonId, activeFlightIndex, activeTicketIndex, nokList, eurList], () => setTimeout(() => lucide.createIcons(), 50), {deep: true});

                return { currentTab, infoSubTab, tabs, travelDays, selectedDayIndex, currentDayItems, selectedCardId, people, activePersonId, activeFlight, flights, activeFlightIndex, activeTicket, activeTicketIndex, specialTickets, activePersonName, hotels, lodgingForToday, qrBase, nextDay, prevDay, handleCardClick, goToHotel, getCategoryIcon, openNavigation, calcNok, calcEur, newNokExp, newEurExp, nokList, eurList, totalNok, totalEur, addExpense, removeExpense };
            }
        }).mount('#app');
    </script>
</body>
</html>